<!-- build time:Sat Jun 08 2024 02:02:40 GMT+0530 (India Standard Time) --><!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="The Workshop" href="https://the-m3chanic.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="The Workshop" href="https://the-m3chanic.github.io/atom.xml"><link rel="alternate" type="application/json" title="The Workshop" href="https://the-m3chanic.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="reversing,bi0sCTF,writeup,crypto,AES"><link rel="canonical" href="https://the-m3chanic.github.io/2024/02/26/Writeup-t0y-b0x-bi0sCTF-2024/"><title>Writeup - t0y-b0x - bi0sCTF 2024 - Writeup | the.m3chanic = The Workshop</title><meta name="generator" content="Hexo 7.0.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Writeup - t0y-b0x - bi0sCTF 2024</h1><div class="meta"><span class="item" title="Created: 26-02-2024 17:09:06"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">Posted on</span> <time itemprop="dateCreated datePublished" datetime="2024-02-26T17:09:06Z">26-02-2024</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">the.m3chanic</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="/images/post_covers/Writeup-t0y-b0x-bi0sCTF-2024.jpg"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">Home</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Writeup/" itemprop="item" rel="index" title="In Writeup"><span itemprop="name">Writeup</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="en"><link itemprop="mainEntityOfPage" href="https://the-m3chanic.github.io/2024/02/26/Writeup-t0y-b0x-bi0sCTF-2024/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Suraj Kumar"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="The Workshop"></span><div class="body md" itemprop="articleBody"><p><strong>tl;dr</strong></p><ul><li>Binary obfuscation with hidden anti-debug checks</li><li>Linear Cryptanalysis (AES with linearly dependent SBOX)</li></ul><p><span id="more"></span></p><p><strong>Challenge points</strong>: 758<br><strong>No. of solves</strong>: 21<br><strong>Challenge Author(s)</strong> : <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9TYXJpbktyaXNobmFuUg==">Sans</span>, <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS90aGVfbTNjaGFuaWNf">the.m3chanic</span></p><h2 id="challenge-description"><a class="anchor" href="#challenge-description">#</a> Challenge description:</h2><p>All my toys are shuffled üò¶</p><h2 id="initial-analysis"><a class="anchor" href="#initial-analysis">#</a> Initial Analysis</h2><p>We're given a stripped C binary along with a <code>ciphertext.txt</code> .</p><p><img data-src="/images/post_images/Writeup-t0y-b0x-bi0sCTF-2024/image.png" alt="alt text"></p><p>We see that the binary is asking for up to 16 bytes of input followed by upto 1024 bytes in the next line - already kind of suspicious, hints AES, but let's see.</p><p>Now right off the bat, there's a conditional check to set an array to one or the other value based on a global variable, let's check that out.</p><p><img data-src="/images/post_images/Writeup-t0y-b0x-bi0sCTF-2024/image-1.png" alt="alt text"></p><p>There are only 2 xrefs to this global symbol, one of them which we are currently checking out - whereas the other one seems to be in another function.</p><p>IDA is unable to decompile it properly, but it says that the function has inline assembly present in it - let's look at that.</p><p><img data-src="/images/post_images/Writeup-t0y-b0x-bi0sCTF-2024/image-2.png" alt="alt text"></p><p>This looks like a fancy way of setting up a syscall, specifically <code>ptrace</code> , so it's an anti-debug check.<br>We can simply patch the jump condition, or nop out this entire function itself - up to whoever is reversing it.</p><p>The output of this function seems to change the values that a specific array is set to, which we'll find to be important later.<br>Additionally, the array that is being set is of length 256, another AES hint.</p><p>The array that is copied into this is initialised from another function, which you can analyse by debugging and see that all it does is initialise an array with values from 0-255.</p><p><img data-src="/images/post_images/Writeup-t0y-b0x-bi0sCTF-2024/image-3.png" alt="alt text"></p><p>This looks like the mix columns function from AES, it also calls the <code>coef_mult</code> that is implemented in AES.</p><p>At this point we can conclude that this binary is implementing AES, but with some modifications to it. The only modification being that the SBOX being used in it is linear (0, 1, 2...255). We can find this out by inspecting the arguments being passed to the <code>aes_encrypt</code> function in main.</p><h2 id="solving-linear-aes"><a class="anchor" href="#solving-linear-aes">#</a> Solving linear AES</h2><p>Looking at the implementation of the <code>sub_bytes</code> function in the binary, we can see this<br></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">sub_bytes</span><span class="params">(<span class="type">uint8_t</span> *state)</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">uint8_t</span> i, j;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; Nb; j++) &#123;</span><br><span class="line">			state[Nb*i+j] = s_box[state[Nb*i+j]];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>This is the only non-linear part of AES, and it's what makes AES resistant to linear attacks. The standard SBOX was designed with this in mind. In this binary, however, we use a linear SBOX.</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>B</mi><mi>O</mi><mi>X</mi><mo stretchy="false">[</mo><mi>i</mi><mo>‚äï</mo><mi>j</mi><mo>‚äï</mo><mn>0</mn><mo stretchy="false">]</mo><mo>=</mo><mi>S</mi><mi>B</mi><mi>O</mi><mi>X</mi><mo stretchy="false">[</mo><mi>i</mi><mo stretchy="false">]</mo><mo>‚äï</mo><mi>S</mi><mi>B</mi><mi>O</mi><mi>X</mi><mo stretchy="false">[</mo><mi>j</mi><mo stretchy="false">]</mo><mo>‚äï</mo><mi>S</mi><mi>B</mi><mi>O</mi><mi>X</mi><mo stretchy="false">[</mo><mn>0</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">SBOX[i \oplus j \oplus 0] = SBOX[i] \oplus SBOX[j] \oplus SBOX[0]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="mord mathnormal" style="margin-right:.05017em">B</span><span class="mord mathnormal" style="margin-right:.02778em">O</span><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">‚äï</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.85396em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.05724em">j</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">‚äï</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">0</span><span class="mclose">]</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="mord mathnormal" style="margin-right:.05017em">B</span><span class="mord mathnormal" style="margin-right:.02778em">O</span><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mclose">]</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">‚äï</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="mord mathnormal" style="margin-right:.05017em">B</span><span class="mord mathnormal" style="margin-right:.02778em">O</span><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:.05724em">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">‚äï</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="mord mathnormal" style="margin-right:.05017em">B</span><span class="mord mathnormal" style="margin-right:.02778em">O</span><span class="mord mathnormal" style="margin-right:.07847em">X</span><span class="mopen">[</span><span class="mord">0</span><span class="mclose">]</span></span></span></span></p><p>The new substitution box can be represented as a linear operation on bits, with just XORs and shuffling bits. Because of this - the AES encryption operation is now affine. Since the first block of plaintext and ciphertext, you can construct a matrix and recover the key this way, using it to decrypt the rest of the ciphertext.</p><p>You can refer to <span class="exturl" data-url="aHR0cHM6Ly9oYWNrbWQuaW8vQHZpc2hpc3dvei9yMTBQN2tud2o=">this</span> and <span class="exturl" data-url="aHR0cHM6Ly9rZXZpbmxpdS5tZS9wb3N0cy9saW5lYXItY3J5cHRhbmFseXNpcy8=">this</span> article for more information on this vulnerability.</p><p>Overall, this was an easy to medium challenge, with just some obfuscation to hide some things being generated in the binary and a vulnerable implementation of AES being implemented. I hope you guys had fun solving the challenge and learnt something new from it as well! üòÉ</p><div class="tags"><a href="/tags/reversing/" rel="tag"><i class="ic i-tag"></i> reversing</a> <a href="/tags/bi0sCTF/" rel="tag"><i class="ic i-tag"></i> bi0sCTF</a> <a href="/tags/writeup/" rel="tag"><i class="ic i-tag"></i> writeup</a> <a href="/tags/crypto/" rel="tag"><i class="ic i-tag"></i> crypto</a> <a href="/tags/AES/" rel="tag"><i class="ic i-tag"></i> AES</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">Edited on</span> <time title="Modified: 15-05-2024 17:00:47" itemprop="dateModified" datetime="2024-05-15T17:00:47Z">15-05-2024</time></span></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>the.m3chanic <i class="ic i-at"><em>@</em></i>The Workshop</li><li class="link"><strong>Post link: </strong><a href="https://the-m3chanic.github.io/2024/02/26/Writeup-t0y-b0x-bi0sCTF-2024/" title="Writeup - t0y-b0x - bi0sCTF 2024">https://the-m3chanic.github.io/2024/02/26/Writeup-t0y-b0x-bi0sCTF-2024/</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/02/26/Writeup-beehive-bi0sCTF-2024/" itemprop="url" rel="prev" data-background-image="&#x2F;images&#x2F;post_covers&#x2F;Writeup-beehive-bi0sCTF.png" title="Writeup - beehive - bi0sCTF 2024"><span class="type">Previous Post</span> <span class="category"><i class="ic i-flag"></i> Writeup</span><h3>Writeup - beehive - bi0sCTF 2024</h3></a></div><div class="item right"><a href="/2024/05/08/R2R-Ready-to-Run-Stomping-WTF/" itemprop="url" rel="next" data-background-image="&#x2F;images&#x2F;post_covers&#x2F;R2R-Stomping-WTF.png" title="R2R (Ready to Run) Stomping - WTF?"><span class="type">Next Post</span> <span class="category"><i class="ic i-flag"></i> Technical</span><h3>R2R (Ready to Run) Stomping - WTF?</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#challenge-description"><span class="toc-number">1.</span> <span class="toc-text">Challenge description:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#initial-analysis"><span class="toc-number">2.</span> <span class="toc-text">Initial Analysis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#solving-linear-aes"><span class="toc-number">3.</span> <span class="toc-text">Solving linear AES</span></a></li></ol></div><div class="related panel pjax" data-title="Related"><ul><li><a href="/2024/01/26/Writeup-Secure-Computing-IRIS-CTF-2024/" rel="bookmark" title="Secure Computing - Iris CTF 2024 Writeup">Secure Computing - Iris CTF 2024 Writeup</a></li><li><a href="/2024/02/26/Writeup-beehive-bi0sCTF-2024/" rel="bookmark" title="Writeup - beehive - bi0sCTF 2024">Writeup - beehive - bi0sCTF 2024</a></li><li class="active"><a href="/2024/02/26/Writeup-t0y-b0x-bi0sCTF-2024/" rel="bookmark" title="Writeup - t0y-b0x - bi0sCTF 2024">Writeup - t0y-b0x - bi0sCTF 2024</a></li></ul></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Suraj Kumar" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Suraj Kumar</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">5</span> <span class="name">posts</span></a></div><div class="item categories"><a href="/categories/"><span class="count">3</span> <span class="name">categories</span></a></div><div class="item tags"><a href="/tags/"><span class="count">18</span> <span class="name">tags</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RoZS1tM2NoYW5pYw==" title="https:&#x2F;&#x2F;github.com&#x2F;the-m3chanic"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS90aGVfbTNjaGFuaWNf" title="https:&#x2F;&#x2F;twitter.com&#x2F;the_m3chanic_"><i class="ic i-twitter"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>About</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2024/02/26/Writeup-beehive-bi0sCTF-2024/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2024/05/08/R2R-Ready-to-Run-Stomping-WTF/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>Random Posts</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Writeup/" title="In Writeup">Writeup</a></div><span><a href="/2024/02/26/Writeup-t0y-b0x-bi0sCTF-2024/" title="Writeup - t0y-b0x - bi0sCTF 2024">Writeup - t0y-b0x - bi0sCTF 2024</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Technical/" title="In Technical">Technical</a></div><span><a href="/2024/05/08/R2R-Ready-to-Run-Stomping-WTF/" title="R2R (Ready to Run) Stomping - WTF?">R2R (Ready to Run) Stomping - WTF?</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Writeup/" title="In Writeup">Writeup</a></div><span><a href="/2024/01/26/Writeup-Secure-Computing-IRIS-CTF-2024/" title="Secure Computing - Iris CTF 2024 Writeup">Secure Computing - Iris CTF 2024 Writeup</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/GSoC/" title="In GSoC">GSoC</a></div><span><a href="/2024/06/07/GSoC-with-RTEMS-1/" title="GSoC with RTEMS! - 1&#x2F;n">GSoC with RTEMS! - 1/n</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Writeup/" title="In Writeup">Writeup</a></div><span><a href="/2024/02/26/Writeup-beehive-bi0sCTF-2024/" title="Writeup - beehive - bi0sCTF 2024">Writeup - beehive - bi0sCTF 2024</a></span></li></ul></div><div><h2>Recent Comments</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2023 ‚Äì <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Suraj Kumar @ the.m3chanic</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2024/02/26/Writeup-t0y-b0x-bi0sCTF-2024/",favicon:{show:"Ôºà‚óè¬¥3ÔΩÄ‚óèÔºâ:)",hide:"(¬¥–îÔΩÄ) :("},search:{placeholder:"Search for Posts",empty:"We didn't find any results for the search: ${query}",stats:"${hits} results found in ${time} ms"},valine:!0,fancybox:!0,copyright:'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->